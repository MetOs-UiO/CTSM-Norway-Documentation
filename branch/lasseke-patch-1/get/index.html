<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Get CTSM &mdash; CTSM-Norway  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinx_lesson.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinx_rtd_theme_ext_color_contrast.css" type="text/css" />
      <link rel="stylesheet" href="../_static/style.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/minipres.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Run CTSM" href="../run/" />
    <link rel="prev" title="Single Point Quick Start" href="../quick-start-single-point/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../" class="icon icon-home"> CTSM-Norway
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Prerequisite</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../prerequisite/">Prerequisites</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Content</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quick-start/">Quick start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick-start-single-point/">Single Point Quick Start</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Get CTSM</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#supported-machines">Supported machines</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-get-ctsm-for-users">How to get CTSM (for users)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-to-get-a-specific-branch">How to get a specific branch</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-get-ctsm-for-developers">How to get CTSM (for developers)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#from-the-nordicesm-hub">From the NordicESM-hub</a></li>
<li class="toctree-l3"><a class="reference internal" href="#from-the-latest-version-of-ctsm">From the latest version of CTSM</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#porting-of-cime">Porting of cime</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../run/">Run CTSM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spinup/">Spin-up CTSM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wrf-ctsm/">WRF-CTSM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/">Tips for developing CTSM</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../license/">Credit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribution/">Contribution</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">CTSM-Norway</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home"></a> &raquo;</li>
      <li>Get CTSM</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/MetOs-UiO/CTSM-Norway-Documentation/blob/main/content/get.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="get-ctsm">
<h1>Get CTSM<a class="headerlink" href="#get-ctsm" title="Permalink to this heading"></a></h1>
<p>Dependent on what you want to do you might want to use different strategies for starting your CTSM work at the right place.</p>
<div class="admonition-path-variables keypoints admonition" id="keypoints-0">
<p class="admonition-title">Path variables</p>
<p>Throughout all this documentation we define some path variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">HOME</span></code>; your home directory on the computer you are currently working on (remote or local). Typically predefined on a Unix system.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTSM_ROOT</span></code>; the top folder or wherever you cloned CTSM</p></li>
</ul>
</div>
<section id="supported-machines">
<h2>Supported machines<a class="headerlink" href="#supported-machines" title="Permalink to this heading"></a></h2>
<p>This tutorial assumes that you are logged into one of the clusters of Sigma2. (See <a class="reference external" href="https://metos-uio.github.io/CTSM-Norway-Documentation/prerequisite/#needed-accesses">here</a> for how to get cluster access).</p>
<p>Currently (February 2022), we support machine configurations for:</p>
<ul class="simple">
<li><p>saga (sigma2, Norway)</p></li>
<li><p>fram (sigma2, Norway)</p></li>
</ul>
<p>If your machine is not on the list and you would like us to support it,
please contact us.</p>
</section>
<section id="how-to-get-ctsm-for-users">
<h2>How to get CTSM (for users)<a class="headerlink" href="#how-to-get-ctsm-for-users" title="Permalink to this heading"></a></h2>
<p>A user is a person that runs CTSM without modifying the source code. To get the FATES EMERALD platform version, CLONE from NordicESM hub</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[~/HOME]$ git clone -b release-clm5.0 https://github.com/NordicESMhub/ctsm.git ${HOME}/ctsm_fates_emerald
</pre></div>
</div>
<p>In this example, we are checking out the release-clm5.0 tag and create a
new local branch (recommended). The destination of the <code class="docutils literal notranslate"><span class="pre">clone</span></code> is a
directory (e.g. ctsm_fates_emerald) in our home directory. From now on, we will call this directory <code class="docutils literal notranslate"><span class="pre">CTSM_ROOT</span></code>.</p>
<p>You can export this path as a variable for easier access in your workspace:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[~/HOME]$ export CTSM_ROOT=${HOME}/ctsm_fates_emerald
</pre></div>
</div>
<section id="how-to-get-a-specific-branch">
<h3>How to get a specific branch<a class="headerlink" href="#how-to-get-a-specific-branch" title="Permalink to this heading"></a></h3>
<p>Change into the created ctsm directory</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[~/HOME]$ cd $CTSM_ROOT
</pre></div>
</div>
<p>Check all existing branches</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[~/CTSM_ROOT]$ git branch --all
</pre></div>
</div>
<p>To check out the FATES EMERALD platform (in this example release 2.0.1)
into a new local branch (e.g. new_branch_name)</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[~/CTSM_ROOT]$ git checkout release-emerald-platform2.0.1 -b new_branch_name
</pre></div>
</div>
<p>For later reference, it is useful to choose new_branch_name according
to function and include the version and your username, e.g.
username_release-emerald-platform2.0.1.</p>
<p>Some components of CTSM are maintained and developed independently of the main model. We call these externals.
To fetch the proper externals (CIME, FATES, etc.) run the below command from the main CTSM directory.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[~/CTSM_ROOT]$ ./manage_externals/checkout_externals
</pre></div>
</div>
<p>All should be set by this and you should be able to create your first case.</p>
</section>
</section>
<section id="how-to-get-ctsm-for-developers">
<h2>How to get CTSM (for developers)<a class="headerlink" href="#how-to-get-ctsm-for-developers" title="Permalink to this heading"></a></h2>
<p>A developer is someone that wishes to change the source code of CTSM.
Depending on which project you wish to contribute to you might want to
start your development from different versions of CTSM. For the
CLM-Norway team we have mainly two starting points:</p>
<ul class="simple">
<li><p>The <a class="reference external" href="https://github.com/NordicESMhub/ctsm">NordicESM-hub</a> (note
that this is a project for developers in the Nordics)</p></li>
<li><p>The latest version of the original
<a class="reference external" href="https://github.com/ESCOMP/CTSM">CTSM</a> (this is the original
version of CTSM developed by NCAR)</p></li>
</ul>
<section id="from-the-nordicesm-hub">
<h3>From the <a class="reference external" href="https://github.com/NordicESMhub/ctsm">NordicESM-hub</a><a class="headerlink" href="#from-the-nordicesm-hub" title="Permalink to this heading"></a></h3>
<p>Follow the steps <a class="reference external" href="https://metos-uio.github.io/CTSM-Norway-Documentation/get/#how-to-get-ctsm-for-users">above</a>, but <code class="docutils literal notranslate"><span class="pre">checkout</span></code> the fates_emerald_api instead</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[~/CTSM_ROOT]$ git checkout fates_emerald_api -b new_branch_name
</pre></div>
</div>
<p>For later reference, it is useful to choose new_branch_name according
to function and include the version and your username, e.g.
username_fates_emerald_api. After checking out the externals, change
to cime directory and create your own branch to record all your changes</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[~/CTSM_ROOT]$ cd cime
[~/CTSM_ROOT/cime]$ git checkout -b username_cime
</pre></div>
</div>
<p>Change to fates directory and create your own branch to record all your
changes</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[~/CTSM_ROOT/cime]$ cd ../src/fates
[~/CTSM_ROOT/fates]$ git checkout -b username_fates
</pre></div>
</div>
<p>If you do not create your own branch for <code class="docutils literal notranslate"><span class="pre">cime</span></code> and <code class="docutils literal notranslate"><span class="pre">fates</span></code>, running
<code class="docutils literal notranslate"><span class="pre">./manage_externals/checkout_externals</span></code> will overwrite your
previous <code class="docutils literal notranslate"><span class="pre">cime</span></code> and <code class="docutils literal notranslate"><span class="pre">fates</span></code>. You should now be ready to create your
first case.</p>
</section>
<section id="from-the-latest-version-of-ctsm">
<h3>From the latest version of <a class="reference external" href="https://github.com/ESCOMP/CTSM">CTSM</a><a class="headerlink" href="#from-the-latest-version-of-ctsm" title="Permalink to this heading"></a></h3>
<p>Start from your home folder and clone CTSM from ESCOMP</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[~/HOME]$ git clone --origin escomp https://github.com/ESCOMP/CTSM.git CTSM
</pre></div>
</div>
<p>Change into the new directory</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[~/HOME]$ cd CTSM
</pre></div>
</div>
<p>Create a local branch</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[~/CTSM_ROOT]$ git checkout master -b my_branch_name
</pre></div>
</div>
<p>For later reference, it is useful to choose <code class="docutils literal notranslate"><span class="pre">my_branch_name</span></code> according
to function and include the version and your username.</p>
<p>To fetch the proper externals (CIME, FATES, etc.) run</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[~/CTSM_ROOT]$ ./manage_externals/checkout_externals
</pre></div>
</div>
<section id="porting-of-cime">
<h4>Porting of cime<a class="headerlink" href="#porting-of-cime" title="Permalink to this heading"></a></h4>
<p>Now you need to add machine specifics for the Norwegian clusters. This
can be done in two ways (check the
<a class="reference external" href="https://esmci.github.io/cime/versions/master/html/users_guide/porting-cime.html#steps-for-porting">original</a>
documentation for a detailed explanation):</p>
<section id="replace-the-default-configurations">
<h5>1) Replace the default configurations<a class="headerlink" href="#replace-the-default-configurations" title="Permalink to this heading"></a></h5>
<p>You can replace some default configuration files with configuration files that contain details for these clusters.
Execute the following steps:</p>
<ol class="arabic">
<li><p>Go into the cime-config folder</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> [~/CTSM_ROOT]$ cd cime/config/cesm/machines
</pre></div>
</div>
</li>
<li><p>Delete the default files:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> [~/CTSM_ROOT/cime/config/cesm/machine]$ rm config_machines.xml config_batch.xml config_compilers.xml
</pre></div>
</div>
</li>
<li><p>Fetch replacement files from <a class="reference external" href="https://github.com/gunnartl/config_files_sigma2.git">this</a> repository by typing</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> [~/CTSM_ROOT/cime/config/cesm/machine]$ git init
 [~/CTSM_ROOT/cime/config/cesm/machine]$ git remote add origin https://github.com/gunnartl/config_files_sigma2.git
 [~/CTSM_ROOT/cime/config/cesm/machine]$ git pull origin main
</pre></div>
</div>
</li>
</ol>
</section>
<section id="create-a-cime-folder">
<h5>2) Create a .cime folder<a class="headerlink" href="#create-a-cime-folder" title="Permalink to this heading"></a></h5>
<p>You can create a <strong>.cime</strong> folder with the machine configurations under your home directory.</p>
<p>Clone <a class="reference external" href="https://github.com/MetOs-UiO/dotcime">this</a> repository and
consult the <code class="docutils literal notranslate"><span class="pre">README.md</span></code> file for the details when making a new
case.</p>
</section>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../quick-start-single-point/" class="btn btn-neutral float-left" title="Single Point Quick Start" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../run/" class="btn btn-neutral float-right" title="Run CTSM" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, CTSM-Norway team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>